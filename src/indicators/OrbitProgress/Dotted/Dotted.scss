@use "../../../scss/variables" as defaults;

$animationDuration: var(--rli-animation-duration, 1.2s);
$animationFn: var(--rli-animation-function, ease-in-out);
$numberOfDots: 12;

@function dottedColorPhase($num: null) {
	$cssVar: var(--dotted-phase1-color);

	@if ($num and $num != 1) {
		$cssVar: var(--dotted-phase#{$num}-color, $cssVar);
	}

	@return $cssVar;
}

.dot-rli-bounding-box {
	--dotted-phase1-color: #{defaults.$defaultColor};

	font-size: defaults.$fontSizer;
	box-sizing: border-box;
	display: inline-block;

	.fading-dot-throbber {
		width: 5em;
		height: 5em;
		color: dottedColorPhase();
		display: inline-block;

		// Create stacking context
		position: relative;
		z-index: 0;

		.fading-dot-text {
			mix-blend-mode: difference;

			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);

			z-index: -2;
		}
		.dot-shape-holder {
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			right: 0;

			transform: rotate(
				calc((var(--elem-pos) - 1) * calc(360deg / $numberOfDots))
			);

			&::before {
				// Algorithm: duration/total_dots * dot_pos
				$animationDelay: calc(
					($animationDuration / $numberOfDots) *
						($numberOfDots - (var(--elem-pos) - 1)) * -1
				);

				content: "";
				display: block;
				margin: 0 auto;
				width: 15%;
				height: 15%;
				background-color: currentColor;
				border-radius: 50%;

				animation:
					$animationDuration $animationFn $animationDelay infinite both fadeDots,
					calc($animationDuration * 4) $animationDelay $animationFn infinite
						dottedProgressColoring;
			}
		}
	}
}

@keyframes fadeDots {
	0%,
	39%,
	100% {
		opacity: 0;
	}
	40% {
		opacity: 1;
	}
}
@keyframes dottedProgressColoring {
	100%,
	0% {
		background-color: dottedColorPhase(1);
	}
	20% {
		background-color: dottedColorPhase(1);
	}
	25% {
		background-color: dottedColorPhase(2);
	}
	45% {
		background-color: dottedColorPhase(2);
	}
	50% {
		background-color: dottedColorPhase(3);
	}
	70% {
		background-color: dottedColorPhase(3);
	}
	75% {
		background-color: dottedColorPhase(4);
	}
	95% {
		background-color: dottedColorPhase(4);
	}
}
